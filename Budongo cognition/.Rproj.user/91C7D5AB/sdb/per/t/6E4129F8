{
    "collab_server" : "",
    "contents" : "####### for revisions\n\nlibrary(bbmle)\nlibrary(MuMIn)\n\n\n### For describing number of trials, etc.\ntable(RSdat$chimp)\nView(RSdat[RSdat$chimp=='Lucy',])\n\n## General picture of accuracy\ntable(RSdat$chimp[RSdat$Correctness==\" Correct\"])\n\ntable(RSdat$chimp[RSdat$Correctness==\" Correct\"])/table(RSdat$chimp)\n\n## some descriptors for revision (Study 2)\ntable(cz_bin_pers$Chimp)\naggregate(as.numeric(cz_bin_pers$Accuracy)-1, by=list(Chimp=cz_bin_pers$Chimp), FUN=mean, na.action = na.omit)\nmean(as.numeric(cz_bin_pers$Accuracy)-1)\n\nsum(table(cz_bin_pers$Accuracy[cz_bin_pers$Chimp=='Liberius'])\n)\n\n\n\n\n\n### Why are the RT simulations crashing? Let's try a few things\nRStemp$logRT = log(RStemp$RT)\n\nrs.rt.glmm.pers.pwr.1 <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                                 Agreeableness + Extraversion +\n                                 (1 | chimp) + (1 | stage) + (1 | TrialType),\n                               family = Gamma(link=\"identity\"),\n                               control =  glmerControl(optimizer = \"optimx\", \n                                                       optCtrl=list(#maxfun=1000, \n                                                         method='nlminb')) \n                               #= glmerControl(optimizer='Nelder_Mead') #nloptwrap\n                               , data = RStemp\n)\n# AIC      BIC   logLik deviance df.resid \n# 79865.8  79948.5 -39921.9  79843.8    13655\nrs.rt.glmm.pers.pwr.2 <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                                 Agreeableness + Extraversion +\n                                 (1 | chimp) + (1 | stage) + (1 | TrialType),\n                               family = Gamma(link=\"inverse\")\n                               , data = RStemp\n)\n# AIC      BIC   logLik deviance df.resid \n# 79825.3  79908.1 -39901.7  79803.3    13655 \nrs.rt.glmm.pers.pwr.3 <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                                 Agreeableness + Extraversion +\n                                 (1 | chimp) + (1 | stage) + (1 | TrialType),\n                               family = Gamma(link=\"log\")\n                               , data = RStemp\n)\n# AIC      BIC   logLik deviance df.resid \n# 79837.7  79920.4 -39907.8  79815.7    13655 \n\n# also vs. the old LMM\n#                     logLik   AIC      \n# rs.rt.lmm.pers     -19647.2  39316.3 \n# ... but this is with different data\n\nAICtab(rs.rt.glmm.pers.pwr.1, rs.rt.glmm.pers.pwr.2, rs.rt.glmm.pers.pwr.3, rs.rt.gamma,\n       #rs.rt.lmm.1, rs.rt.lmm.1.day, rs.rt.lmm.1.td,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \n\nsummary(rs.rt.glmm.pers.pwr.2)\n\nr.squaredGLMM(rs.rt.lmm.pers) # not usable on the Gamma models\n\n\n\n### Moving fwd with log Gamma models\n\n# which are by far the most stable of the link options\n# New models start here:\n\nrs.rt.logamma <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                         Agreeableness + Extraversion +\n                         (1 | chimp) + (1 | stage) + (1 | TrialType) #+ (1 | Section) + (1 | depend)\n                       ,family = Gamma(link=\"log\"),\n                       control =  glmerControl(optimizer = 'Nelder_Mead')\n                       , data = RStemp\n)\n\nrs.rt.logamma.d <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                           Agreeableness + Extraversion + scale(day) + \n                           (1 | chimp) + (1 | stage) + (1 | TrialType) #+ (1 | Section) + (1 | depend)\n                         ,family = Gamma(link=\"log\"),\n                         control =  glmerControl(optimizer = 'Nelder_Mead')\n                         \n                         , data = RStemp\n)\nAICtab(rs.rt.logamma, rs.rt.logamma.d,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-39906.3+39907.8),12-11,lower.tail=F)\n# 0.08326452\n# Stick with initial model.\n\n\n# rs.rt.logamma.td <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n#                             Agreeableness + Extraversion + scale(day) + scale(Trial) + \n#                             (1 | chimp) + (1 | stage) + (1 | TrialType) #+ (1 | Section) + (1 | depend)\n#                           ,family = Gamma(link=\"log\")\n#                           # ,control =  glmerControl(optimizer = \"optimx\", \n#                           #                          optCtrl=list(#maxfun=1000,\n#                           #                            method='L-BFGS-G')) \n#                           , data = RStemp\n# )\n# AICtab(rs.rt.gamma, rs.rt.gamma.d, rs.rt.invgamma, rs.rt.invgamma.d, \n#        rs.rt.logamma, rs.rt.logamma.d, rs.rt.logamma.td,\n#        #rs.rt.lmm.1, rs.rt.lmm.1.day, rs.rt.lmm.1.td,\n#        weights=T, delta=T, base=T, logLik=T, sort=T) \n\n\nrs.rt1.logamma <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                          Agreeableness + Extraversion +\n                          (1 | chimp) + (1 | stage) + (1 | TrialType) #+ (1 | Section) + (1 | depend)\n                        ,family = Gamma(link=\"log\"),\n                        control =  glmerControl(optimizer = 'Nelder_Mead')\n                        , data = RStemp[RStemp$Correctness==' Correct',]\n)\n\nrs.rt1.logamma.d <- glmer(RT ~ Dominance + Conscientiousness + Openness + Neuroticism +\n                            Agreeableness + Extraversion + scale(day) + \n                            (1 | chimp) + (1 | stage) + (1 | TrialType) #+ (1 | Section) + (1 | depend)\n                          ,family = Gamma(link=\"log\"),\n                          control =  glmerControl(optimizer = 'Nelder_Mead')\n                          , data = RStemp[RStemp$Correctness==' Correct',]\n)\nAICtab(rs.rt1.logamma, rs.rt1.logamma.d,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-23913.0+23913.1),12-11,lower.tail=F)\n# 0.6547208\n\n# Stick with model 1.\n\n# New models mean new CIs\n\nci.RT = confint(rs.rt.logamma, method='Wald')\nci.RT.1 = confint(rs.rt1.logamma, method='Wald')\n\n\n\n### We were probably using the wrong model distr for RTs. Well, for consistency, we need to use log Gamma now anyway\n### Study 2 RTs\n\nlibrary(optimx)\n\n# All trials - processing time\nmod.ptG.1 <- glmer(procTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                   + Agreeableness + Extraversion + (1 | Chimp),\n                   family = Gamma(link=\"log\")\n                   , data=cz_bin_pers\n)\nmod.ptG.2 <- glmer(procTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                   + Agreeableness + Extraversion + s(day) + (1 | Chimp),\n                   family = Gamma(link=\"log\"),\n                   control =  glmerControl(optimizer = \"optimx\", \n                                           optCtrl=list(#maxfun=1000, \n                                             method='nlminb'))\n                   , data=cz_bin_pers\n)\nAICtab(mod.ptG.1, mod.ptG.2,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-4414.4+4552.8),10-9,lower.tail=F)\n# [1] 3.740638e-62\nmod.ptG.3 <- glmer(procTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                   + Agreeableness + Extraversion + s(day) + s(Trial) + (1 | Chimp),\n                   family = Gamma(link=\"log\"),\n                   #control =  glmerControl(optimizer = 'Nelder_Mead'#\"optimx\", \n                   # optCtrl=list(maxfun=1000, \n                   #   method='L-BFGS-G') #'nlminb'\n                   #)\n                   data=cz_bin_pers\n) # Will not converge - stick with model 2.\n\n\n## Rewarded trials - processing time\nmod.ptGrw.1 <- glmer(procTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                     + Agreeableness + Extraversion + (1 | Chimp),\n                     family = Gamma(link=\"log\"),\n                     control =  glmerControl(optimizer = \"optimx\", \n                                             optCtrl=list(#maxfun=1000, \n                                               method='nlminb')) \n                     , data=cz_bin_pers[cz_bin_pers$Accuracy==1,]\n)\nmod.ptGrw.2 <- glmer(procTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                     + Agreeableness + Extraversion + s(day) + (1 | Chimp),\n                     family = Gamma(link=\"log\"),\n                     control =  glmerControl(optimizer = \"optimx\", \n                                             optCtrl=list(#maxfun=1000, \n                                               method='nlminb')) \n                     , data=cz_bin_pers[cz_bin_pers$Accuracy==1,]\n)\nAICtab(mod.ptGrw.1, mod.ptGrw.2,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-2480.8+2539.8),10-9,lower.tail=F)\n# 1.73388e-27\nmod.ptGrw.3 <- glmer(procTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                     + Agreeableness + Extraversion + s(day) + s(Trial) + (1 | Chimp),\n                     family = Gamma(link=\"log\"),\n                     control =  glmerControl(optimizer = \"optimx\", \n                                             optCtrl=list(#maxfun=1000, \n                                               method='nlminb')) \n                     , data=cz_bin_pers[cz_bin_pers$Accuracy==1,]\n)\nAICtab(mod.ptGrw.1, mod.ptGrw.2, mod.ptGrw.3,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-2472.9+2480.8),10-9,lower.tail=F)\n# 7.040251e-05\n\n# Model 3 is the best.\npchisq(2*(-2472.9+2539.8),10-8,lower.tail=F)\n\n\n## All trials - inspection time\nmod.itG.1 <- glmer(inspecTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                   + Agreeableness + Extraversion + (1 | Chimp),\n                   family = Gamma(link=\"log\")\n                   , data=cz_bin_pers\n)\nmod.itG.2 <- glmer(inspecTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                   + Agreeableness + Extraversion + s(day) + (1 | Chimp),\n                   family = Gamma(link=\"log\")\n                   , data=cz_bin_pers\n)\nAICtab(mod.itG.1, mod.itG.2,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-4692.2+4836),10-9,lower.tail=F)\n# 1.657685e-64\nmod.itG.3 <- glmer(inspecTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                   + Agreeableness + Extraversion + s(day) + s(Trial) + (1 | Chimp),\n                   family = Gamma(link=\"log\"),\n                   control =  glmerControl(optimizer = \"optimx\", \n                                           optCtrl=list(#maxfun=1000, \n                                             method='nlminb')) \n                   , data=cz_bin_pers\n)\nAICtab(mod.itG.1, mod.itG.2, mod.itG.3,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-4659.5+4692.2),11-10,lower.tail=F)\n# 6.113889e-16\n\n# Model 3 is the best.\n\n\n## Rewarded trials - inspection time\nmod.itGrw.1 <- glmer(inspecTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                     + Agreeableness + Extraversion + (1 | Chimp),\n                     family = Gamma(link=\"log\")\n                     , data=cz_bin_pers[cz_bin_pers$Accuracy==1,]\n)\nmod.itGrw.2 <- glmer(inspecTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                     + Agreeableness + Extraversion + s(day) + (1 | Chimp),\n                     family = Gamma(link=\"log\")\n                     , data=cz_bin_pers[cz_bin_pers$Accuracy==1,]\n)\nAICtab(mod.itGrw.1, mod.itGrw.2,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-2567.6+2631.5),10-9,lower.tail=F)\n# 1.241432e-29\nmod.itGrw.3 <- glmer(inspecTime ~ Dominance + Conscientiousness + Openness + Neuroticism\n                     + Agreeableness + Extraversion + s(day) + s(Trial) + (1 | Chimp),\n                     family = Gamma(link=\"log\")\n                     , data=cz_bin_pers[cz_bin_pers$Accuracy==1,]\n)\nAICtab(mod.itGrw.1, mod.itGrw.2, mod.itGrw.3,\n       weights=T, delta=T, base=T, logLik=T, sort=T) \npchisq(2*(-2547.6+2567.6),10-9,lower.tail=F)\n# 2.539629e-10\n\n# Model 3 is the best.\npchisq(2*(-2547.6+2631.5),10-8,lower.tail=F)\n\n## New CIs\n\nci.pt2.G <- confint(mod.ptG.2, method='Wald')\nci.ptrw.3.G <- confint(mod.ptGrw.3, method='Wald')\nci.it3.G <- confint(mod.itG.3, method='Wald')\nci.itrw.3.G <- confint(mod.itGrw.3, method='Wald')\n\n\n\n### Power analysis results\n\n# D\nd.pwr = c(81,63,77, 95)\nmean(d.pwr)\n  \n# C\nc.pwr = c(93,73,93,65,92,90,77)\nmean(c.pwr)\n\n# O\no.pwr = c(80,76,50,96)\nmean(o.pwr)\n\n# N\nn.pwr = c(77)\n\n# A\na.pwr = c(95,87,60,26)\nmean(a.pwr)\n\n# E\ne.pwr = c(96,88,94,93,88,84,97,86,81,87)\nmean(e.pwr)\n\n\n\n### Combining and anonymizing data for Dryad\n\nchNames = c('A3850','B1436','C2114','D6517','E7774','F2037','G5131','H2266','I3971',\n            'J9399','K5443','L1147','M2488','N4140','O7218','P7437','Q6065','R0466'\n            #,'S8073' # Lyndsey is the last in the list\n)\nmapping = data.frame(old = aggPers$Chimp,\n                     new = chNames)\n\n## Study 1\n\ncolnames(RSdat)\nDryad1 <- RSdat[,c(-11,-12)]\n\nDryad1$chimp <- with(mapping, new[match(Dryad1$chimp, old)])\n\nwrite.csv(Dryad1, file=\"../Study1.csv\")\n\n\n## Study 2\n\ncolnames(cz_bin_pers)\nDryad2.1 <- cz_bin_pers[,c(1:2,8:14,27)]\nDryad2.1$Chimp <- with(mapping, new[match(Dryad2.1$Chimp, old)])\nwrite.csv(Dryad2.1,file='Study2performance.csv')\n\n\ncolnames(DMAeng)\nDryad2.2 <- DMAeng[,c(1:4)]\nDryad2.2$Chimp <- with(mapping, new[match(Dryad2.2$Chimp, old)])\nwrite.csv(Dryad2.2,file='Study2participation.csv')\n\n\n### Study 3\n\ncolnames(inPodL) \nDryad3.1 <- inPodL[,c(1:3)]\nDryad3.1$Chimp <- with(mapping, new[match(Dryad3.1$Chimp, old)])\nwrite.csv(Dryad3.1,file='Study3inPods.csv')\n\ncolnames(tatScreen)\nDryad3.2 <- tatScreen[,c(1:5)]\nDryad3.2$Individual <- with(mapping, new[match(Dryad3.2$Individual, old)])\nwrite.csv(Dryad3.2,file='Study3atScreen.csv')\n\n",
    "created" : 1487079084968.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1496586329",
    "id" : "6E4129F8",
    "lastKnownWriteTime" : 1487944129,
    "last_content_update" : 1487944129208,
    "path" : "C:/Users/s1229179/GitHub/R/Budongo cognition/revisions.R",
    "project_path" : "revisions.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}