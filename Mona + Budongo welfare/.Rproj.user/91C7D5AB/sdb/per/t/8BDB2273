{
    "collab_server" : "",
    "contents" : "\n# model <- lmer(Score ~ 1 + (1|Rater) + (1|Chimp) + (1|Item) + \n#                 (1|Chimp:Rater) + (1|Chimp:Item) + (1|Item:Rater), data=melted)\n# \n# counts <- list(length(levels(melted$Rater)),length(levels(melted$Item)))\n# names(counts) <- c(\"Rater\",\"Item\")\n# #model <- lmer(Score ~ (1|Chimp) + (1|Rater) + (1|Item) + (1|Chimp:Rater) + (1|Chimp:Item) + (1|Item:Rater), melted)\n# vcomp <- VarCorr(model)\n# \n# vcompLbls <- c(\"Rater\",\"Chimp\",\"Item\",\"Chimp:Rater\",\"Chimp:Item\",\"Item:Rater\")\n# \n# varCompTable(vcomp, vcompLbls)\n# \n# \n# \n# phi <- calcPhiCoefficient(\"Chimp\",vcomp,vcompLbls,counts)\n# cat(\"Φ =\", substr(sprintf(\"%.3f\",round(phi,3)),2,5))\n\n\nlibrary(lme4)\n\nmodel <- lmer(Score ~ 1 + (1|Rater) + (1|Chimp) + (1|Item) + (1|Time) +\n                (1|Chimp:Rater) + (1|Chimp:Item) + (1|Chimp:Time) + \n                (1|Rater:Item) + (1|Rater:Time) + (1|Item:Time) +\n                (1|Rater:Time:Chimp) + (1|Rater:Time:Item) + \n                (1|Time:Chimp:Item) + (1|Rater:Chimp:Item)\n              , data=melted)\n\nlist(model = model)\n\n\ndat$Chimp <- factor(dat$Chimp)\ndat$Rater <- factor(dat$Rater)\ndat$Item <- factor(dat$Item)\ndat$Time <- factor(dat$Time)\n\ncounts <- list(length(levels(melted$Rater)),length(levels(melted$Item)), length(levels(melted$Time)))\nnames(counts) <- c(\"Rater\",\"Item\",\"Time\")\n\nmodel <- lmer(Score ~ 1 + (1|Rater) + (1|Chimp) + (1|Item) + (1|Time) +\n                (1|Chimp:Rater) + (1|Chimp:Item) + (1|Chimp:Time) + \n                (1|Rater:Item) + (1|Rater:Time) + (1|Item:Time) +\n                (1|Rater:Time:Chimp) + (1|Rater:Time:Item) + \n                (1|Time:Chimp:Item) + (1|Rater:Chimp:Item)\n              , data=melted)\n\nvcomp <- VarCorr(model)\nvcompLbls <- c(\"Rater\",\"Chimp\",\"Item\",'Time',\n               \"Chimp:Rater\",\"Chimp:Item\",'Chimp:Time',\n               \"Rater:Item\",'Rater:Time','Item:Time',\n               'Rater:Time:Chimp','Rater:Time:Item',\n               'Time:Chimp:Item','Rater:Chimp:Item')\n\n\n\n\n\n\n\nvarCompTable <- function(vcomp,vcompLbls) {\n  compOut <- c()\n  lbl <- c()\n  for(i in 1:length(vcomp)){\n    compOut[i] <- vcomp[[vcompLbls[i]]][,1]\n    lbl[i] <- vcompLbls[i]\n  }\n  compOut[length(vcomp)+1] <- attr(vcomp, \"sc\")[[1]]^2\n  lbl[length(vcomp)+1] <- \"Residual\"\n  \n  compTbl <- data.frame(round(compOut,3),round(compOut/sum(compOut),3)*100)\n  #rownames(compTbl) <- lbl\n  rownames(compTbl) <- gsub(\":\",\"*\",lbl)\n  colnames(compTbl) <- c(\"VarComp\",\"%\")\n  \n  compTblTemp <- compTbl[1:(nrow(compTbl)-1),]\n  compTblTemp <- compTblTemp[order(compTblTemp[,1],decreasing=T),]\n  compTblOrderd <- rbind(compTblTemp,compTbl[nrow(compTbl),])\n  cat(\"Variance components\\n\\n\")\n  print(compTbl)\n  cat(\"\\nVariance components (Sorted)\\n\\n\")\n  print(compTblOrderd)\n}\n\n\nvarCompTable(vcomp, vcompLbls)\n\n\n\n\n\n\n### G ###\n\ncalcGCoefficient <- function(uniVal,vcomp,vcompLbls,ids,counts) {\n#             calcGCoefficient(\"Chimp\",vcomp,vcompLbls,grep(\":Chimp\\\\b|\\\\bChimp:\",vcompLbls),counts)\n  denoms <- c()\n  denomsVal <- c()\n  denoms[1] <- \"as.numeric(vcomp[[uniVal]])\"\n  denomsVal[1] <- as.numeric(vcomp[[uniVal]])\n  \n#  ids = grep(\":Chimp\\\\b|\\\\bChimp:\",vcompLbls)\n  \n  if (length(ids) > 0) {\n    for(i in 1:length(ids)) {\n      denomItem <- gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[ids[i]])\n      if (length(grep(\":\",denomItem)) > 0){\n        items <- strsplit(denomItem,\":\")\n        countNums <- c()\n        for (j in 1:length(items[[1]])) {\n          countNums[j] <- counts[[items[[1]][j]]]\n        }\n        denoms[i+1] <- paste('(as.numeric(vcomp[[vcompLbls[ids[',i,']]]]) / ',prod(countNums),')',sep=\"\")\n        denomsVal[i+1] <- as.numeric(vcomp[[vcompLbls[ids[i]]]]) / prod(countNums)\n      } else {\n        denoms[i+1] <- paste('(as.numeric(vcomp[[vcompLbls[ids[',i,']]]]) / counts[[gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[ids[',i,']])]])',sep=\"\")\n        ### this denominator below is where the problem is\n        denomsVal[i+1] <- as.numeric(vcomp[[vcompLbls[ids[i]]]]) / counts[[gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[ids[i]])]]\n      }\n    }\n  }\n  \n  countNums <- c()\n  for (i in 1:length(counts)) {\n    countNums[i] <- counts[[i]]\n  }\n  denoms[length(denoms) + 1] <- '(attr(vcomp, \"sc\")[[1]]^2 / prod(countNums))'\n  denomsVal[length(denomsVal) + 1] <- attr(vcomp, \"sc\")[[1]]^2 / prod(countNums)\n  return(eval(parse(text=paste(denoms[1],\"/ (\",paste(denoms,collapse=\" + \"),\")\"))))\n}\n\n#  counts[[gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[ids[i]])]]\n\ngcoeff <- calcGCoefficient(\"Chimp\",vcomp,vcompLbls,grep(\":Chimp\\\\b|\\\\bChimp:\",vcompLbls),counts)\n\ncat(\"G =\", substr(sprintf(\"%.3f\", round(gcoeff, 3)), 2, 5))\n\n})\n\n\n\n\ncounts <- list(length(levels(melted$Rater)),length(levels(melted$Item)), length(levels(melted$Time)),\n               length(levels(melted$Chimp)))\nnames(counts) <- c(\"Rater\",\"Item\",\"Time\",\"Chimp\")\n\ncalcPhiCoefficient <- function(uniVal,vcomp,vcompLbls,counts) {\n  \n#  uniVal = 'Chimp'\n  \n  denoms <- c()\n  denomsVal <- c()\n  denoms[1] <- \"as.numeric(vcomp[[uniVal]])\"\n  denomsVal[1] <- as.numeric(vcomp[[uniVal]])\n  if (length(vcompLbls) > 2) {\n    for(i in 2:length(vcompLbls)) {\n      denomItem <- gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[i])\n      if (length(grep(\":\",denomItem)) > 0){\n        items <- strsplit(denomItem,\":\")\n        countNums <- c()\n        for (j in 1:length(items[[1]])) {\n          countNums[j] <- counts[[items[[1]][j]]]\n        }\n        denoms[i] <- paste('(as.numeric(vcomp[[vcompLbls[',i,']]]) / ',prod(countNums),')',sep=\"\")\n        denomsVal[i] <- as.numeric(vcomp[[vcompLbls[i]]]) / prod(countNums)\n      } else {\n        denoms[i] <- paste('(as.numeric(vcomp[[vcompLbls[',i,']]]) / counts[[gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[',i,'])]])',sep=\"\")\n        # this denominator below is the problem\n        denomsVal[i] <- as.numeric(vcomp[[vcompLbls[i]]]) / counts[[gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[i])]]\n      }\n    }\n  } else {\n    denoms[2] <- paste('(as.numeric(vcomp[[vcompLbls[2]]]) / ',prod(counts[[1]]),')',sep=\"\")\n    denomsVal[2] <- as.numeric(vcomp[[vcompLbls[2]]]) / prod(counts[[1]])\n  }\n  # break\n  \n  countNums <- c()\n  for (i in 1:length(counts)) {\n    countNums[i] <- counts[[i]]\n  }\n  denoms[length(denoms) + 1] <- '(attr(vcomp, \"sc\")[[1]]^2 / prod(countNums))'\n  denomsVal[length(denomsVal) + 1] <- attr(vcomp, \"sc\")[[1]]^2 / prod(countNums)\n  return(eval(parse(text=paste(denoms[1],\"/ (\",paste(denoms,collapse=\" + \"),\")\"))))\n}\n\nphi <- calcPhiCoefficient(\"Chimp\",vcomp,vcompLbls,counts)\ncat(\"Φ =\", substr(sprintf(\"%.3f\",round(phi,3)),2,5))\n\ncounts[[gsub(paste(\":\",uniVal,\"|\",uniVal,\":\",sep=\"\"),\"\",vcompLbls[i])]]\n\n",
    "created" : 1454692637333.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3658212991",
    "id" : "8BDB2273",
    "lastKnownWriteTime" : 1462900672,
    "last_content_update" : 1462900672806,
    "path" : "C:/Users/s1229179/GitHub/R/Mona + Budongo welfare/gTv2.R",
    "project_path" : "gTv2.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}