{
    "collab_server" : "",
    "contents" : "### NHANES III data\nlibrary(SAScii)\nlibrary(psych)\n\nnhanes.bm <- read.SAScii('Z:/NHANES III/DS0010/02231-0010-Data.txt',\n                         'Z:/NHANES III/DS0010/02231-0010-Setup.sas')\n\nnhanes.ex <- read.SAScii('Z:/NHANES III/exam/DS0002/02231-0002-Data.txt',\n                         'Z:/NHANES III/exam/DS0002/02231-0002-Setup.sas')\n\nsort( sapply(ls(),function(x){object.size(get(x))}))\n\n\n### Chimps\n\nc.bm <- read.csv(file = 'cNHANES.csv')\nc.bm$wbc = c.bm$wbc/1000\nc.bm$lymph = c.bm$lymph*1000\n\n\n\n# Vars of interest\n\nhist(nhanes.bm$HSSEX) # sex\nhist(nhanes.bm$HSAGEIR) # age at 'interview'\n\n\n\nHEMATOLOGY\nWCP - WBC count - I think this needs to be /1000 in the chimps\nRCP - RBC count\nHTP - Hematocrit (%)\nHGP - Hemaglobin\nMVPSI - Mean corpuscular / cell volume (SI)\nMCPSI - mean corpuscular / cell hemaglobin (SI)\nMHP - mean cell hemaglobin concentration\nLMPDIF - lymphocytes (% of 100 cells) - I think this need to be *1000 in chimps\nMOPDIF - monocytes (% of 100 cells)\nEOP - eosinophils (% of 100 cells)\n#BOP - basophils (% of 100 cells) # not in chimps\n\nSERUM BIOCHEMISTRY\nSGP - Glucose\nBUP - Blood Urea Nitrogen\nCEP - Creatinine\nTPP - (total) Protein\nAMP - Albumin\nTBP - (total) Bilirubin\nAPPSI - Alkaline Phosphatase\nATPSI - Alanine Aminotransferase (SGPT)\nASPSI - Aspartate aminotransferase (SGOT)\nTCP - (total) Cholesterol\nSCP - (total) Calcium\nPSP - Phosphorus\nNAPSI - Sodium\nSKPSI - Potassium\nCLPSI - Chloride\n- AG ratio?\n- BC ratio?\nGBP - Globulin\n! - Lipase\n! - Amylase \nTBP - Triglycerides\n! - Creatine Phosphokinase\nGGPSI - Gamma-glutamyl transpeptidase (GGTP)\n! - Magnesium\nOSPSI - Osmolality\n\nEXAM DATA (*NEW* - from different file)\nBMPBMI - BMI\nPEPMNK1R - Systolic BP (avg)\nPEPMNK5R - Diastolic BP (avg)\n\n\n\n\n\n\n\n# selecting out which variable we want to work with\n\n# temp: for now, using the vars in common with the chimp set\n\n\nbmlabels = c('SEQN',\"HSSEX\",\"HSAGEIR\", \n             'WCP','RCP','HTP','HGP','MVPSI','MCPSI','MHP',\n             'LMPDIF','MOPDIF','EOP',#'BOP', not in chimps\n             'SGP','BUP','CEP','TPP','AMP','TBP','APPSI','ATPSI','ASPSI',\n             'TCP','SCP','PSP','NAPSI','SKPSI','CLPSI','GBP','TGP','GGPSI',\n             'OSPSI')\n# bmlabels %in% colnames(nhanes.bm)\n\n\nsel.nbm = nhanes.bm[,bmlabels]\n\nsel.nx = nhanes.ex[,c('SEQN','BMPBMI','PEPMNK1R','PEPMNK5R')]\n\nsel.nbm = merge(sel.nbm, sel.nx, by = c('SEQN'))\n# can rm the original files past this point\n#rm(nhanes.bm)\n#rm(nhanes.ex)\n\n\n# fixing the NA coding\n#table(sel.nbm[,'SGP'])\n\nsel.nbm$WCP[sel.nbm$WCP == 88888] = NA\n\nsel.nbm$RCP[sel.nbm$RCP == 8888] = NA\n\nsel.nbm$HTP[sel.nbm$HTP == 88888] = NA\n\nsel.nbm$HGP[sel.nbm$HGP == 88888] = NA\n\nsel.nbm$MVPSI[sel.nbm$MVPSI == 88888] = NA\n\nsel.nbm$MCPSI[sel.nbm$MCPSI == 88888] = NA\n\nsel.nbm$MHP[sel.nbm$MHP == 88888] = NA\n\nsel.nbm$LMPDIF[sel.nbm$LMPDIF == 888] = NA\n\nsel.nbm$MOPDIF[sel.nbm$MOPDIF == 88] = NA\n\nsel.nbm$EOP[sel.nbm$EOP == 88] = NA\n\nsel.nbm$BOP[sel.nbm$BOP == 88] = NA\n\nsel.nbm$SGP[sel.nbm$SGP == 888] = NA\n\nsel.nbm$BUP[sel.nbm$BUP == 888] = NA\n\nsel.nbm$CEP[sel.nbm$CEP == 8888] = NA\n\nsel.nbm$TPP[sel.nbm$TPP == 8888] = NA\n\nsel.nbm$AMP[sel.nbm$AMP == 888] = NA\n\nsel.nbm$TBP[sel.nbm$TBP == 8888] = NA\n\nsel.nbm$APPSI[sel.nbm$APPSI == 8888] = NA\n\nsel.nbm$ATPSI[sel.nbm$ATPSI == 888] = NA\n\nsel.nbm$ASPSI[sel.nbm$ASPSI == 888] = NA\n\nsel.nbm$TCP[sel.nbm$TCP == 888] = NA\n\nsel.nbm$SCP[sel.nbm$SCP == 8888] = NA\n\nsel.nbm$PSP[sel.nbm$PSP == 8888] = NA\n\nsel.nbm$NAPSI[sel.nbm$NAPSI == 88888] = NA\n\nsel.nbm$SKPSI[sel.nbm$SKPSI == 8888] = NA\n\nsel.nbm$CLPSI[sel.nbm$CLPSI == 88888] = NA\n\nsel.nbm$GBP[sel.nbm$GBP == 888] = NA\n\nsel.nbm$TGP[sel.nbm$TGP == 8888] = NA\n\nsel.nbm$GGPSI[sel.nbm$GGPSI == 8888] = NA\n\nsel.nbm$OSPSI[sel.nbm$OSPSI == 888] = NA\n\nsel.nbm$PEPMNK1R[sel.nbm$PEPMNK1R == 888] = NA\n\nsel.nbm$PEPMNK5R[sel.nbm$PEPMNK5R == 888] = NA\n\nsel.nbm$BMPBMI[sel.nbm$BMPBMI == 8888] = NA\n\n\n# remove rows with all NAs for non-demographic data\n# 35 vars, 32 of which are BMs\n\nsel.nbm <- sel.nbm[(rowSums(is.na(sel.nbm))<32),]\n\ncolnames(c.bm)[c(2,4)] = c('subject','age')\n\ncolnames(sel.nbm)[1:35] <- colnames(c.bm)[2:36]\n\nc.bm$species = as.factor('chimp')\nsel.nbm$species = as.factor('human')\n\n\n### Set a seed and split the data into exploration and conformation batches\n\nset.seed(12345)\nsampl.nbm <- sample(29314)  \nsampl.pca <- sampl.nbm[1:9000]\nsampl.cfa <- sampl.nbm[9001:18000]\n\n### Chimp data -\n### What about an averaged version?\n\nc.bm.m = aggregate(c.bm, by = list(c.bm$subject), FUN=mean, na.rm=T\n                   , na.action=na.pass)\n# head(c.bm.m)\nc.bm.m$subject = c.bm.m$Group.1\nc.bm.m$species = 'chimp'\nc.bm.m = c.bm.m[,c(-1,-2)]\n\n# in NHANES males are 1 and females are 2 so we change to that\nc.bm.m$sex[c.bm.m$sex==0] <- 2\n\n\n\n### Scaling\n\n# Independent for BMI\n\nc.bm.m.s = c.bm.m\nc.bm.m.s$BMI = scale(c.bm.m.s$BMI, center=T)\n#c.bm.m.s[,c(3:35)] = data.frame(lapply(c.bm.m.s[,c(3:35)], function(x) scale(x, center = T)))\n\n\n\n# Age adjustment for chimps\n\nc.bm.m.s$age = c.bm.m.s$age * 1.5\n\n\n\n\nall.bm = sel.nbm[sampl.cfa,]\nall.bm$BMI = scale(all.bm$BMI, center=T)\n\n# Composite df\n\nall.bm = rbind(all.bm,\n               c.bm.m.s)\n                 #complete.cases(sel.nbm),])\n\nmax(complete.cases)\n\n# Non-independent scaling for everything else\n\nall.bm[,c(3:35)] = data.frame(lapply(all.bm[,c(3:35)], function(x) scale(x, center = T)))\n\nall.bm$sex = as.factor(all.bm$sex)\n\ndescribe(all.bm)\n\n\n\n",
    "created" : 1459777675183.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1262831663",
    "id" : "EC7D5EFB",
    "lastKnownWriteTime" : 1498147587,
    "last_content_update" : 1498147587040,
    "path" : "C:/Users/s1229179/GitHub/R/Yerkes/NHANES/import.R",
    "project_path" : "import.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}