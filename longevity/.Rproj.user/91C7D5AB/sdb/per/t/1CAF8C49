{
    "contents" : "# survival analyses\n\n\n# library(OutlierDC)\n# \n# foA <- odc(themodel, data=Dataset, method=\"score\")\n# foB <- odc(themodel, data=Dataset, method=\"residual\")\n# foC <- odc(themodel, data=Dataset, method=\"boxplot\")\n# \n# fo1 <- odc(yLt ~ as.factor(sex) + \n#              as.factor(origin) + as.factor(LvZ) + \n#              Dom_CZ + Ext_CZ + Con_CZ +\n#              Agr_CZ + Neu_CZ + Opn_CZ, data=datX, method=\"score\")\n# fo2 <- odc(yLt ~ as.factor(sex) + \n#              as.factor(origin) + as.factor(LvZ) + \n#              Dom_CZ + Ext_CZ + Con_CZ +\n#              Agr_CZ + Neu_CZ + Opn_CZ, data=datX, method=\"residual\")\n# fo3 <- odc(yLt ~ as.factor(sex) + \n#              as.factor(origin) + as.factor(LvZ) + \n#              Dom_CZ + Ext_CZ + Con_CZ +\n#              Agr_CZ + Neu_CZ + Opn_CZ, data=datX, method=\"boxplot\")\n## seem pretty meaningless\n\n\n# Alex's code for finding the ideal distribution\n\nthedistributions<-c(\"weibull\",\"exponential\",\"lognormal\",\"loglogistic\")\n\n\nthemodel <- (y ~ as.factor(Dataset$sex) + Dataset$age_pr + #Dataset$age + \n               as.factor(Dataset$origin) + as.factor(Dataset$LvZ) + \n               Dataset$Dom_CZ + Dataset$Ext_CZ + Dataset$Con_CZ +\n               Dataset$Agr_CZ + Dataset$Neu_CZ + Dataset$Opn_CZ\n)\n\nmodel.p <- (y ~ Dataset$Dom_CZ + Dataset$Ext_CZ + Dataset$Con_CZ +\n               Dataset$Agr_CZ + Dataset$Neu_CZ + Dataset$Opn_CZ\n)\n\nmodel.agexE <- (y ~ as.factor(Dataset$sex) + \n                  as.factor(Dataset$origin) + as.factor(Dataset$LvZ) +\n                Dataset$Dom_CZ + Dataset$Ext_CZ + Dataset$Con_CZ +\n              Dataset$Agr_CZ + Dataset$Neu_CZ + Dataset$Opn_CZ +\n                Dataset$Ext_CZ*Dataset$age_pr_adj\n              )\n\ndistlist = 0\nLLlist1 = 0\nLLlist2 = 0\nestimates = 0\nfor (i in 1:length(thedistributions)) {\n  thisdist = thedistributions[i]\n  fit = survreg(themodel, dist = thisdist)\n  distlist[i] = thisdist\n  LLlist1[i] = -2*(fit$loglik[1])\n  LLlist2[i] = -2*(fit$loglik[2])\n  estimates[i] = exp(as.numeric(fit$coefficients[2]))  }\nResult = data.frame(distlist, LLlist1, LLlist2, estimates, LLlist1 - LLlist2)\nnames(Result) = c(\"Distribution\", \"-2*LL(Baseline)\", \"-2*LL(Full)\",\"Estimate\")\nResult = Result[order(Result[,3]),]\nResult\n\n# loglogistic? weibull?\n\n\n### The model(s)\n\nmod1.w <- survreg(themodel, dist = 'weibull')\nmod1.ll <- survreg(themodel, dist = 'loglogistic')\nmod1.e <- survreg(themodel, dist = 'exponential')\n\nmod.p.ll <- survreg(model.p, dist = 'loglogistic')\n  \nsummary(mod1.ll)\n\nfit1 <- survfit(themodel)\n\nmod2.ll <- survreg(model.agexE, dist = 'loglogistic')\n\nmod.3 <- coxph(themodel)\n# Cox model doesn't support \"mright\" survival data\n\nlibrary(car)\n\n\n### INTERVAL censoring?\n### ... left TRUNCATION (!)\n#library(flexsurv)\n\n\n#“extreme”, “logistic”, “gaussian”, “weibull”, “exponential”, “rayleigh”, “loggaussian”, \n# “lognormal”, “loglogistic”, “t\n\nmod.trunc <- survreg(yLt ~ as.factor(sex) + \n                       as.factor(origin) + as.factor(LvZ) + \n                       Dom_CZ + Con_CZ + Ext_CZ +\n                       Agr_CZ + Neu_CZ + Opn_CZ #+ adjE\n                     ,dist = \"t\", data=datX\n                     )\n# Log(scale)                2.061     0.0465  44.340 0.00e+00\n# maybe change from extreme to t?\n\n# Log(scale)                 1.505     0.0627 23.989 3.66e-127\n# better with t\n\nsummary(mod.trunc)\n\nconfint(mod.trunc)\n\nexp(as.numeric(mod.trunc$coefficients[7]))\n\nmod.t.adj <- survreg(yLt ~ as.factor(sex) + \n                       as.factor(origin) + as.factor(LvZ) + \n                       adjD + adjE + adjC +\n                       adjA + adjN + adjO,\n                     dist = \"t\", data=datX\n)\n\n\n                 \n# Thought:                  \n# subtract year(s) from DoD of those who died before being rated...? \n# Done - see importProcess\n\nmod.t.agexE <- survreg(yLt ~ as.factor(sex) + \n                       as.factor(origin) + as.factor(LvZ) + \n                       Dom_CZ + Ext_CZ + Con_CZ +\n                       Agr_CZ + Neu_CZ + Opn_CZ\n                       + DoB:Ext_CZ\n                       , dist = \"t\", data=datX\n)\nsummary(mod.t.agexE)\n                 \nanova(mod.t.agexE)\n\nmod.t.agexEDNO <- survreg(yLt ~ as.factor(sex) + \n                         as.factor(origin) + as.factor(LvZ) + \n                         Dom_CZ + Ext_CZ + Con_CZ +\n                         Agr_CZ + Neu_CZ + Opn_CZ\n                       + age_pr:Ext_CZ + age_pr:Dom_CZ\n                       + age_pr:Neu_CZ + age_pr:Opn_CZ\n                       , dist = \"t\", data=datX\n)\n\n\nsource(\"https://bioconductor.org/biocLite.R\")\nbiocLite(\"survcomp\")\n\nsurvdiff(themodel)\n#Error in survdiff(themodel) : Right censored data only   # what the hell\n\nlibrary(coin)\n#logrank_test(themodel)\n\n\n\nfit.T1 <- survfit(yLt ~ as.factor(sex) + \n                    as.factor(origin) + as.factor(LvZ) + \n                    Dom_CZ + Ext_CZ + Con_CZ +\n                    Agr_CZ + Neu_CZ + Opn_CZ\n                  , data=datX)\n\n\n# residualized E in AFT?\n\nmod.E.r2 <- survreg(yLt ~ as.factor(sex) + \n                    as.factor(origin) + as.factor(LvZ) + \n                    Dom_CZ + E.r2.DoB + Con_CZ + #E.resid3 +\n                    Agr_CZ + Neu_CZ + Opn_CZ\n                  , data=datX, dist='t')\n\nsummary(mod.t.Er2)\n\n# O and E residulized\n\nmod.EO.r2 <- survreg(yLt ~ as.factor(sex) + \n                       as.factor(origin) + as.factor(LvZ) + \n                       Dom_CZ + E.r2.DoB + Con_CZ + #E.resid3 +\n                       Agr_CZ + Neu_CZ + O.r2.DoB\n                     , data=datX, dist='t') # this model is informed by LASSO\n\n\n\n# with all significantly confounded dimensions properly residualized\nmod.EODN.r <- survreg(yLt ~ as.factor(sex) + \n                       as.factor(origin) + as.factor(LvZ) + \n                        D.r3.DoB + E.r3.DoB + Con_CZ + #E.resid3 +\n                       Agr_CZ + N.r1.DoB + O.r2.DoB\n                     , data=datX, dist='t')\n\n\nmod.EODN.r.betr <- survreg(yLt ~ as.factor(sex) + \n                           as.factor(origin) + as.factor(LvZ) + \n                           D.r3 + E.r3 + Con_CZ + #E.resid3 +\n                           Agr_CZ + N.r1 + O.r2\n                         , data=datX, dist='t')\n\n\n\n### LASSO...\n\nlibrary(glmnet)\n\nnetform <- Dataset[,c(2,62,66,71,72,73,74,75,76,77)]\nnetform$origin <- droplevels(netform$origin)\nx <- model.matrix( ~ sex + age_pr + origin + LvZ + \n                     Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ - 1, netform)\n\nx <- x[,-3] # fix some origin glitches\ny1 <- y[-354,]\n  \nnet1 <- glmnet(x, y1, family=\"cox\")\n\n# this isn't working:\nnet1.cv <- cv.glmnet(x, y1, family=\"cox\", type.measure = \"deviance\", grouped=FALSE)\nplot(net1.cv)\n\nplot(net1, label=T)\nplot(net1, xvar=\"lambda\", label=T)  \nplot(net1, xvar=\"dev\", label=T) \n\n\ncoef(net1, s=net1.cv$lambda.min\n     )\ncoef(net1, s=0.01)\n\n\n### testing distr for left truncation\n\ntruncdistributions = c(\"t\",\"extreme\",\"logistic\")\n\ntruncmod <- (yLt ~ as.factor(datX$sex) + \n                       as.factor(datX$origin) + as.factor(datX$LvZ) + \n               datX$Dom_CZ + datX$Ext_CZ + datX$Con_CZ +\n               datX$Agr_CZ + datX$Neu_CZ + datX$Opn_CZ)\n\ndistlist = 0\nLLlist1 = 0\nLLlist2 = 0\nestimates = 0\nfor (i in 1:length(truncdistributions)) {\n  thisdist = truncdistributions[i]\n  fit = survreg(truncmod, dist = thisdist)\n  distlist[i] = thisdist\n  LLlist1[i] = -2*(fit$loglik[1])\n  LLlist2[i] = -2*(fit$loglik[2])\n  estimates[i] = exp(as.numeric(fit$coefficients[2]))  }\nResult = data.frame(distlist, LLlist1, LLlist2, estimates, LLlist1 - LLlist2)\nnames(Result) = c(\"Distribution\", \"-2*LL(Baseline)\", \"-2*LL(Full)\",\"Estimate\")\nResult = Result[order(Result[,3]),]\nResult\n\n\n# Extreme value distribution\n# Loglik(model)= -846.9   Loglik(intercept only)= -957.9\n# Chisq= 221.83 on 10 degrees of freedom, p= 0 \n# Number of Newton-Raphson Iterations: 6 \n# n=361 (1 observation deleted due to missingness)\n# \n# 1            t        1793.482    1577.619 0.11779359 215.8636\n# 3     logistic        1797.079    1587.880 0.08042083 209.1991\n# 2      extreme        1915.704    1693.870 0.02409324 221.8341\n\n\nattr(yLt, 'type') <- 'mcounting'\n",
    "created" : 1448036952550.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3418211754",
    "id" : "1CAF8C49",
    "lastKnownWriteTime" : 1448907340,
    "path" : "C:/Users/s1229179/GitHub/R/longevity/chimpAnalyses.R",
    "project_path" : "chimpAnalyses.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}