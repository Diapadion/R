{
    "collab_server" : "",
    "contents" : "### Parametric frailty models\n\n\n\n\n\nlibrary(survival)\nlibrary(parfm)\nlibrary(frailtypack)\nlibrary(bbmle)\n# strata won't really work with these\n\nfpack.u = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + #strata(strt)\n                         as.factor(sex) + as.factor(origin) +  \n                         Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                       data = datX, hazard =  'Piecewise-equi' , nb.int = 1\n                       #, n.knots = 4, kappa =1\n)\nfpack.u.15 = update(fpack.u, nb.int=15)\nfpack.u.10 = update(fpack.u, nb.int=10)\nfpack.u.9 = update(fpack.u, nb.int=9)\nfpack.u.8 = update(fpack.u, nb.int=8)\nfpack.u.7 = update(fpack.u, nb.int=7)\nfpack.u.6 = update(fpack.u, nb.int=6)\nfpack.u.5 = update(fpack.u, nb.int=5)\nfpack.u.4 = update(fpack.u, nb.int=4)\nfpack.u.3 = update(fpack.u, nb.int=3)\nfpack.u.2 = update(fpack.u, nb.int=2)\n\nfpfLL=NULL\n\nfpfLL[20] = update(fpack.u, nb.int=20)$logLik\nfpfLL[19] = update(fpack.u, nb.int=19)$logLik\nfpfLL[18] = update(fpack.u, nb.int=18)$logLik\nfpfLL[17] = update(fpack.u, nb.int=17)$logLik\nfpfLL[16] = update(fpack.u, nb.int=16)$logLik\nfpfLL[15] = fpack.u.15$logLik\nfpfLL[14] = update(fpack.u, nb.int=14)$logLik\nfpfLL[13] = update(fpack.u, nb.int=13)$logLik\nfpfLL[12] = update(fpack.u, nb.int=12)$logLik\nfpfLL[11] = update(fpack.u, nb.int=11)$logLik\nfpfLL[10] = fpack.u.10$logLik\nfpfLL[9] = fpack.u.9$logLik\nfpfLL[8] = fpack.u.8$logLik\nfpfLL[7] = fpack.u.7$logLik\nfpfLL[6] = fpack.u.6$logLik\nfpfLL[5] = fpack.u.5$logLik\nfpfLL[4] = fpack.u.4$logLik\nfpfLL[3] = fpack.u.3$logLik\nfpfLL[2] = fpack.u.2$logLik\nfpfLL[1] = fpack.u$logLik\n\n\npchisq(2*(fpack.u.9$logLik-fpack.u$logLik), df=9-1, lower.tail = F)\nsummary(fpack.u.9)\n\n#fpack.u.10$AIC\n\n\nfpack.r = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + #strata(strt)\n                         as.factor(sex) + as.factor(origin) +  \n                         D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                       data = datX, hazard =  'Piecewise-equi' , nb.int = 1\n                       #, n.knots = 4, kappa =1\n)\n\nfpfLLr = NULL\nfpfLLr[20] = update(fpack.r, nb.int=20)$logLik\nfpfLLr[19] = update(fpack.r, nb.int=19)$logLik\nfpfLLr[18] = update(fpack.r, nb.int=18)$logLik\nfpfLLr[17] = update(fpack.r, nb.int=17)$logLik\nfpfLLr[16] = update(fpack.r, nb.int=16)$logLik\nfpfLLr[15] = update(fpack.r, nb.int=15)$logLik\nfpfLLr[14] = update(fpack.r, nb.int=14)$logLik\nfpfLLr[13] = update(fpack.r, nb.int=13)$logLik\nfpfLLr[12] = update(fpack.r, nb.int=12)$logLik\nfpfLLr[11] = update(fpack.r, nb.int=11)$logLik\nfpfLLr[10] = update(fpack.r, nb.int=10)$logLik\nfpfLLr[9] = update(fpack.r, nb.int=9)$logLik\nfpfLLr[8] = update(fpack.r, nb.int=8)$logLik\nfpfLLr[7] = update(fpack.r, nb.int=7)$logLik\nfpfLLr[6] = update(fpack.r, nb.int=6)$logLik\nfpfLLr[5] = update(fpack.r, nb.int=5)$logLik\nfpfLLr[4] = update(fpack.r, nb.int=4)$logLik\nfpfLLr[3] = update(fpack.r, nb.int=3)$logLik\nfpfLLr[2] = update(fpack.r, nb.int=2)$logLik\nfpfLLr[1] = fpack.r$logLik\n\nplot(fpfLLr)\n\nfpack.r.9 = update(fpack.r, nb.int=9)\n\nsummary(fpack.r.9)\nplot(fpack)\n\n# AICtab(fpack.u, fpack.r,\n#        logLik=T, sort=T, delta=T, base=T,weights=T)\n\nfpack.u$AIC\nfpack.u.10$AIC\nfpack.r$AIC\n\n\n\n# Specifications of interest\n\nfpack.u.0f = frailtyPenal(Surv(age_pr, age, status) ~ #cluster(sample) + \n                         as.factor(sex) + as.factor(origin) +  \n                         Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                       data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                       #, n.knots = 4, kappa =1\n)\n\nfpack.r.0f = frailtyPenal(Surv(age_pr, age, status) ~ #cluster(sample) + \n                            as.factor(sex) + as.factor(origin) +  \n                            D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                          data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                          #, n.knots = 4, kappa =1\n)\n\nfpack.u.x = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                            as.factor(sex) + #as.factor(origin) +  \n                            Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                          data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                          #, n.knots = 4, kappa =1\n)\n\nfpack.r.x = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                            as.factor(sex) + #as.factor(origin) +  \n                            D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                          data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                          #, n.knots = 4, kappa =1\n)\n\nfpack.u.x.sx = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                           #as.factor(sex) + #as.factor(origin) +  \n                           Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                         data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                         #, n.knots = 4, kappa =1\n)\n\nfpack.r.x.sx = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                           #as.factor(sex) + #as.factor(origin) +  \n                           D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                         data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                         #, n.knots = 4, kappa =1\n)\n\n\nfpack.r.x.sx.D = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                              #as.factor(sex) + #as.factor(origin) +  \n                              D.r2.DoB,\n                            data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                            #, n.knots = 4, kappa =1\n)\nfpack.r.x.sx.E = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                                #as.factor(sex) + #as.factor(origin) +  \n                                E.r2.DoB,\n                              data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                              #, n.knots = 4, kappa =1\n)\nfpack.r.x.sx.A = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                                #as.factor(sex) + #as.factor(origin) +  \n                                Agr_CZ,\n                              data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                              #, n.knots = 4, kappa =1\n)\n\nfpack.r.i.si.A = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                                as.factor(sex) + as.factor(origin) +  \n                                Agr_CZ,\n                              data = datX, hazard =  'Piecewise-equi' , nb.int = 9\n                              #, n.knots = 4, kappa =1\n)\n\n\n\n### these won't converge\n\nfpack.u.i.M = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                             as.factor(sex) + as.factor(origin) +  \n                             Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                           data = datX[datX$sex=='Female',], hazard =  'Piecewise-equi' , nb.int = 9\n                           #, n.knots = 4, kappa =1\n                           , maxit = 3000\n)\n\nfpack.r.i.M = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                             as.factor(sex) + as.factor(origin) +  \n                             D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                           data = datX[datX$sex=='Female',], hazard =  'Piecewise-equi' , nb.int = 9\n                           #, n.knots = 4, kappa =1\n                           , maxit = 2000\n)\n\n### nor does this\n\nfpack.u.i.w = frailtyPenal(Surv(age_pr, age, status) ~ cluster(sample) + \n                                         as.factor(sex) + as.factor(origin) +  \n                                         Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                                       data = datX, hazard =  'Weibull' \n                                       , n.knots = 2, kappa =1\n)\n                           \n\n\n### prelim anal for Yerkes - AL connection\n\nfpack.u.i.si.6.Y = frailtyPenal(Surv(age_pr, age, status) ~ #cluster(sample) + \n                                as.factor(sex) + as.factor(origin) +  \n                                Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                              data = datX[datX$sample==6,], hazard =  'Piecewise-equi' , nb.int = 9\n                              #, n.knots = 4, kappa =1\n)\n\n\n\n\n\n\npfm.u.i.g.6 = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='nlminb')\npfm.r.i.g.6 = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='nlminb')\nprint(pfm.u.i.g.6)\nprint(pfm.r.i.g.6)\n# pfm.s.i.g.6 = parfm(Surv(age_pr, age, status) ~ \n#                       as.factor(sex) + as.factor(origin) +  \n#                       Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n#                     cluster=\"sample\" ,strata = \"strt\"\n#                     , frailty = 'gamma'\n#                     , data=datX, dist='gompertz', method ='nlminb')\n\n\npfm.u.x.g.6 = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) +# as.factor(origin) +  \n                      Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='nlminb')\n\npfm.r.x.g.6 = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) +# as.factor(origin) +  \n                      D.r2.DoB + E.r2.DoB + Con_CZ + Agr_CZ + N.r1.DoB + O.r2.DoB,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\n\nprint(pfm.u.x.g.6)\n\npfm.u.i.g.D = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Dom_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\npfm.u.i.g.E = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Ext_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\npfm.u.i.g.C = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Con_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\npfm.u.i.g.A = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Agr_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\npfm.u.i.g.N = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Neu_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\npfm.u.i.g.O = parfm(Surv(age_pr, age, status) ~ \n                      as.factor(sex) + as.factor(origin) +  \n                      Opn_CZ,\n                    cluster=\"sample\" #strata = \"strt\"\n                    , frailty = 'gamma'\n                    , data=datX, dist='gompertz', method ='ucminf')\n\nprint(pfm.u.i.g.6)\nprint(pfm.r.i.g.6)\n\n\n\n\n\n\n\n# is this the same as AFT?\n\nlibrary(eha)\n\naft.parfm.eq1 = parfm(Surv(age_pr, age, status) ~ \n                        as.factor(sex) + as.factor(origin) +  \n                        Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                      #cluster=\"sample\" #strata = \"strt\"\n                      , frailty = 'none'\n                      , data=datX, dist='gompertz', method ='nlminb')\n\naft.parfm.eq2 = aftreg(Surv(age_pr, age, status) ~ \n                     as.factor(sex) + as.factor(origin) +  \n                     Dom_CZ + Ext_CZ + Con_CZ + Agr_CZ + Neu_CZ + Opn_CZ,\n                   data = datX, param = 'lifeAcc',\n                   dist = 'gompertz')\n\nprint(aft.parfm.eq1)\nsummary(aft.parfm.eq2)\n",
    "created" : 1489580937810.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1076325507",
    "id" : "969256F4",
    "lastKnownWriteTime" : 1494345773,
    "last_content_update" : 1494345773271,
    "path" : "C:/Users/s1229179/GitHub/R/longevity/parametricFM.R",
    "project_path" : "parametricFM.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}