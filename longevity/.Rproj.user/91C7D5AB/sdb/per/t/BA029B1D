{
    "contents" : "# Sex: Male = 1, Female = 2\n# Age: Becomes centered\n\nlibrary(survival)\nlibrary(ggplot2)\n\nload(\"Gorilla.RData\")\n\nDataset.xfer1993 <- read.csv(file=\"gorilla_xfer_1993.csv\",header=T,na.string=\"n/a\")\nnames(Dataset.xfer1993)[1] <- \"GORILLA\"\nnames(Dataset.xfer1993)[12] <- \"xfer1993\"\nxfervars <- c(\"GORILLA\",\"xfer1993\")\nnew.xfer1993 <- Dataset.xfer1993[xfervars]\n\nDataset.old <- Dataset\nDataset.old <- Dataset[!is.na(Dataset$ACTIVE1),]\n\nDataset <- merge(Dataset.old,new.xfer1993,by=\"GORILLA\")\n\ngroupsize <- as.data.frame(table(Dataset$ZOO1))\nnames(groupsize) <- c(\"ZOO1\",\"group\")\n\nDataset <- merge(Dataset,groupsize,by=\"ZOO1\")\n\nDataset <- Dataset[which(Dataset$rearing2<3 & Dataset$GORILLA != 1190\n                         & Dataset$GORILLA != 1182 & Dataset$GORILLA\n                         != 341 & Dataset$GORILLA !=358 &\n                         Dataset$GORILLA != 359 & Dataset$GORILLA != 1050),]\n\n#Dataset$AGE <- as.vector(scale(Dataset$AGE,center=T,scale=F))\n\nDataset$xfer <- NA\nDataset$xfer[Dataset$xfer1993==0]<-\"0\"\nDataset$xfer[Dataset$xfer1993==1]<-\"1\"\nDataset$xfer[Dataset$xfer1993>=2]<-\"2 to 8\"\nDataset$xfer <- factor(Dataset$xfer)\n\nDataset$background <- NA\nDataset$background[Dataset$birth.type==1] <- 0\nDataset$background[Dataset$birth.type==2 & Dataset$rearing2==1] <-1\nDataset$background[Dataset$birth.type==2 & Dataset$rearing2==2] <-2\nDataset$background <- factor(Dataset$background)\n\nDataset$captive_vs_wild <- NA\nDataset$captive_vs_wild[Dataset$background==0] <- -1\nDataset$captive_vs_wild[Dataset$background==1 | Dataset$background==2] <- .5\n\nDataset$hand_vs_mother <-NA  \nDataset$hand_vs_mother[Dataset$background==0] <- 0\nDataset$hand_vs_mother[Dataset$background==1] <- -1\nDataset$hand_vs_mother[Dataset$background==2] <- 1\n\nattach(Dataset)\nDataset$Extroverted<-scale((-1*(SOCIABL1+PLAYFUL1+ACTIVE1+POPULAR1+CURIOUS1-SOLITAR1-SLOW1)))\nDataset$Dominant<-scale((-1*(AGGRESS1+EFFECTI1+IRRITAB1+STRONG1+OPPORTU1+EXCITAB1)))\nDataset$Fearful<-scale((-1*(FEARFUL1+APPREHE1+INSECUR1+TENSE1+ECCENTR1-CONFIDE1)))\nDataset$Understanding<-scale((-1*(UNDERSTA+PROTECTI+PERMISS1+EQUABLE1+MOTHER1)))\ndetach(Dataset)\n\n# Creating age at death for one subject\nDataset$age.at.death[Dataset$GORILLA==292]<-(Dataset$AGE[Dataset$GORILLA==292])+(3203/365.25)\n\n# Adding a month based on the correct date of ratings. This was done\n# in Japan but not carried over to this machine until now.\nDataset$time2<-Dataset$time2+31\n\n# Finding the best distribution\nthedistributions<-c(\"weibull\",\"exponential\",\"lognormal\",\"loglogistic\")\n\ny <- Surv(Dataset$time2,Dataset$august.2011.status)\n\nthemodel <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n             Dataset$background + Dataset$xfer + Dataset$Extroverted +\n             Dataset$Dominant + Dataset$Fearful +\n             Dataset$Understanding)\n             \ndistlist = 0\nLLlist1 = 0\nLLlist2 = 0\nestimates = 0\nfor (i in 1:length(thedistributions)) {\nthisdist = thedistributions[i]\nfit = survreg(themodel, dist = thisdist)\ndistlist[i] = thisdist\nLLlist1[i] = -2*(fit$loglik[1])\nLLlist2[i] = -2*(fit$loglik[2])\nestimates[i] = exp(as.numeric(fit$coefficients[2]))  }\nResult = data.frame(distlist, LLlist1, LLlist2, estimates)\nnames(Result) = c(\"Distribution\", \"-2*LL(Baseline)\", \"-2*LL(Full)\",\"Estimate\")\nResult = Result[order(Result[,3]),]\nResult\n\n# 1: sex, age\nmodel1 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE)\nmodel1a <- (y ~ Dataset$xfer)\nmodel1b <- (y ~ as.factor(Dataset$SEX) + Dataset$xfer)\nmodel1c <- (y ~ Dataset$AGE + Dataset$xfer)\nmodel1d <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE + Dataset$xfer)\n\n# 2: sex, age, rearing, transfers\nmodel2 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer)\n\n# 3: sex, age, rearing, birth type, transfers, extroverted\nmodel3 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer + Dataset$Extroverted)\n\n# 4: sex, age, rearing, birth type, transfers, extroverted, dominant\nmodel4 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer + Dataset$Extroverted + Dataset$Dominant)\n\n# 5: sex, age, rearing, transfers, birth type, extroverted, dominant, fearful\nmodel5 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer + Dataset$Extroverted + Dataset$Dominant +\n           Dataset$Fearful)\n\n# 6: sex, age, rearing, transfers, birth type, extroverted, dominant, fearful, understanding\nmodel6 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background + Dataset$xfer + Dataset$Extroverted +\n           Dataset$Dominant + Dataset$Fearful + Dataset$Understanding)\n\nmodel6a <- (y ~ as.factor(Dataset$ZOO1) + as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background + Dataset$xfer + Dataset$Extroverted +\n           Dataset$Dominant + Dataset$Fearful + Dataset$Understanding)\n\nmodel6b <- (y ~ Dataset$group + as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background + Dataset$xfer + Dataset$Extroverted +\n           Dataset$Dominant + Dataset$Fearful + Dataset$Understanding)\n\n# 7: sex, age, rearing, transfers,birth type, extroverted, dominant, fearful,\n# understanding, and sex interactions\nmodel7 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer + Dataset$Extroverted + Dataset$Dominant +\n           Dataset$Fearful + Dataset$Understanding +\n           Dataset$Extroverted:Dataset$SEX +\n           Dataset$Dominant:Dataset$SEX + Dataset$Fearful:Dataset$SEX\n           + Dataset$Understanding:Dataset$SEX)\n\n# 8: sex, age, rearing, transfers,birth type, extroverted, fearful,\n# understanding, and age interactions\nmodel8 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer + Dataset$Extroverted + Dataset$Dominant +\n           Dataset$Fearful + Dataset$Understanding +\n           Dataset$Extroverted:Dataset$AGE +\n           Dataset$Dominant:Dataset$AGE + Dataset$Fearful:Dataset$AGE\n           + Dataset$Understanding:Dataset$AGE)\n\n# 9: sex, age, rearing, transfers, birth type, extroverted, fearful,\n# understanding, and background\n\nmodel9 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n           Dataset$background +\n           Dataset$xfer + Dataset$Extroverted + Dataset$Dominant +\n           Dataset$Fearful + Dataset$Understanding +\n           Dataset$Extroverted:Dataset$background +\n           Dataset$Dominant:Dataset$background +\n           Dataset$Fearful:Dataset$background +\n           Dataset$Understanding:Dataset$background)\n\n# 10: sex, age, rearing, transfers, birth type, extroverted, fearful,\n# understanding, and transfers interactions\nmodel10 <- (y ~ as.factor(Dataset$SEX) + Dataset$AGE +\n            Dataset$background +\n            Dataset$xfer + Dataset$Extroverted + Dataset$Dominant +\n            Dataset$Fearful + Dataset$Understanding +\n            Dataset$Extroverted:Dataset$xfer +\n            Dataset$Dominant:Dataset$xfer +\n            Dataset$Fearful:Dataset$xfer +\n            Dataset$Understanding:Dataset$xfer)\n\n# AFT models\naft_model1 <- survreg(model1,dist=\"weibull\")\naft_model1a <- survreg(model1a,dist=\"weibull\")\naft_model1b <- survreg(model1b,dist=\"weibull\")\naft_model1c <- survreg(model1c,dist=\"weibull\")\naft_model1d <- survreg(model1d,dist=\"weibull\")\naft_model2 <- survreg(model2,dist=\"weibull\")\naft_model3 <- survreg(model3,dist=\"weibull\")\naft_model4 <- survreg(model4,dist=\"weibull\")\naft_model5 <- survreg(model5,dist=\"weibull\")\naft_model6 <- survreg(model6,dist=\"weibull\")\naft_model6a <- survreg(model6a,dist=\"weibull\")\naft_model6b <- survreg(model6b,dist=\"weibull\")\naft_model7 <- survreg(model7,dist=\"weibull\")\naft_model8 <- survreg(model8,dist=\"weibull\")\naft_model9 <- survreg(model9,dist=\"weibull\")\naft_model10 <- survreg(model10,dist=\"weibull\")\n\n# Plotting Extraversion\n\n#Dataset$extraversion_cut<-NA\n#Dataset$extraversion_cut[Dataset$Extroverted < -1] <- 4\n#Dataset$extraversion_cut[Dataset$Extroverted <= -.5 & Dataset$Extroverted >= -1] <- 3\n#Dataset$extraversion_cut[Dataset$Extroverted >= -.5 & Dataset$Extroverted <= .5] <- 2\n#Dataset$extraversion_cut[Dataset$Extroverted > .5 & Dataset$Extroverted <= 1] <- 1\n#Dataset$extraversion_cut[Dataset$Extroverted > 1] <- 0\n\nDataset$extraversion_cut<-NA\nDataset$extraversion_cut[Dataset$Extroverted < -.7242] <- 1\nDataset$extraversion_cut[Dataset$Extroverted <= .1130 & Dataset$Extroverted >= -.7242] <- 2\nDataset$extraversion_cut[Dataset$Extroverted > .1130 & Dataset$Extroverted <= .7880] <- 3\nDataset$extraversion_cut[Dataset$Extroverted > .7880] <- 4\n\nmean_total_time <- tapply(Dataset$time2,Dataset$extraversion_cut,mean,na.rm=T)\nsd_total_time <- tapply(Dataset$time2,Dataset$extraversion_cut,sd,na.rm=T)\nnpts_total_time <- tapply(Dataset$time2,Dataset$extraversion_cut,length)\nproportion_deaths <- tapply(Dataset$august.2011.status,Dataset$extraversion_cut,mean,na.rm=T)\nextraversion_cat <- as.numeric(names(mean_total_time))\n\nplots <-\nas.data.frame(cbind(extraversion_cat,mean_total_time,sd_total_time,npts_total_time,proportion_deaths))\n\nplots <- transform(plots,se_total_time=(sd_total_time/sqrt(npts_total_time)))\n\np <- ggplot(plots,aes(as.factor(extraversion_cat),mean_total_time,fill=proportion_deaths))+geom_bar()\n\np <-\np+scale_fill_gradient(low=\"lightgray\",high=\"black\",name=\"Proportion Deceased\")+theme_bw()\n\np <-\np+scale_x_discrete(name=\"Extraversion Quartile\")+scale_y_continuous(name=\"Days to Death or Censoring\")\n\n# Change font for Proc Royal\np+opts(legend.text=theme_text(family=\"Times\",size=9),legend.title=theme_text(family=\"Times\",size=11),\naxis.text.x=theme_text(family=\"Times\",size=9),axis.title.x=theme_text(family=\"Times\",size=11),\naxis.text.y=theme_text(family=\"Times\",size=9),axis.title.y=theme_text(family=\"Times\",size=11,angle=90,vjust=0.4))\n\n# Add error bars\n# p <-\n#p+geom_errorbar(aes(ymin=(mean_total_time-(1.96*se_total_time)),ymax=(mean_total_time+(1.96*se_total_time))),width=.25)\n\n#mfit<-survfit(Surv(time2,august.2011.status==1)~extraversion_cut,data=Dataset)\n# 6: sex, age, rearing, transfers, birth type, extroverted, dominant, fearful, understanding\n\n# Supplementary analysis 1: test whether dropping younger animals adversely\n# effects the results\nDataset.older <- Dataset[Dataset$AGE>=10,]\n\ny.older <- Surv(Dataset.older$time2,Dataset.older$august.2011.status)\n\nmodel6_older <- (y.older ~ as.factor(Dataset.older$SEX) + Dataset.older$AGE +\n           Dataset.older$background + Dataset.older$xfer + Dataset.older$Extroverted +\n           Dataset.older$Dominant + Dataset.older$Fearful +\n           Dataset.older$Understanding)\n\naft_model6_older <- survreg(model6_older,dist=\"weibull\")\n\n# Show results of second supplementary analysis: Age and sex alone\nsummary(aft_model1)\n\n# Show results of third supplementary analysis:\nsummary(aft_model1b)\n\n# Save figure\nggsave(file=\"final_gorilla_figure_6_nov_2012.pdf\",height=17.5, width=17.5,units=\"cm\")\n",
    "created" : 1448037031422.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "36933173",
    "id" : "BA029B1D",
    "lastKnownWriteTime" : 1448037022,
    "path" : "C:/Users/s1229179/GitHub/R/longevity/gorilla_mortality.R",
    "project_path" : "gorilla_mortality.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}